#!/usr/bin/env bash

rm -rf _site
mkdir -p _site/css

# Setup trap to kill background processes on exit
trap 'kill $(jobs -p)' EXIT

# Start sass watch in the background
nix-shell -p sass --pure --command "
  echo 'Compiling SCSS'
  sass --watch src/_scss:_site/css --style compressed
" &

# Start eleventy serve in the background
nix-shell -p nodePackages.pnpm --command "
  echo 'Serving site'
  pnpm add fast-glob @11ty/eleventy @11ty/eleventy-plugin-rss
  pnpm eleventy --serve
" &

# Wait for both processes
wait
